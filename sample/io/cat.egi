(define $main
  (lambda [$args]
    (match args (list string)
      {[<nil> (each-line id)]
       [_ (each-file args)]})))

(define $each-file
  (lambda [$files]
    (match files (list string)
      {[<nil> (return [])]
       [<cons $file $rest>
        (do {[$port (open-input-file file)]
             [(each-line-from-port port id)]
             [(close-input-port port)]}
          (each-file rest))]})))